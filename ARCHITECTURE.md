# ğŸ—ï¸ Architecture Documentation - Auth System

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (Client)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              HTML (index.html, dashboard.html)          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚  <script src="js/auth-state.js"></script>      â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  <script src="js/header-loader.js"></script>   â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  <script src="js/navigation.js"></script>      â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  <script src="js/dashboard.js"></script>       â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           Authentication State (auth-state.js)         â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  window.AuthState {                                    â”‚    â”‚
â”‚  â”‚    isAuthenticated: boolean                            â”‚    â”‚
â”‚  â”‚    user: { id, email, name }                          â”‚    â”‚
â”‚  â”‚    initialized: boolean                                â”‚    â”‚
â”‚  â”‚    subscribers: []                                      â”‚    â”‚
â”‚  â”‚    initialize()                                         â”‚    â”‚
â”‚  â”‚    logout()                                             â”‚    â”‚
â”‚  â”‚    subscribe(callback)                                 â”‚    â”‚
â”‚  â”‚  }                                                      â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  GET /api/auth/verify â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                    â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           Header Renderer (header-loader.js)           â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Subscribes to AuthState changes                       â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  if (AuthState.isLoggedIn()) {                        â”‚    â”‚
â”‚  â”‚    Render: "Hello [Name]" + "Logout"                 â”‚    â”‚
â”‚  â”‚  } else {                                              â”‚    â”‚
â”‚  â”‚    Render: "Login" + "Get Forecast"                  â”‚    â”‚
â”‚  â”‚  }                                                      â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  POST /api/auth/logout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                   â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚    Page Components (dashboard.js, auth.js, etc.)      â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  GET /api/user/profile â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                     â”‚    â”‚
â”‚  â”‚  POST /api/auth/login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                     â”‚    â”‚
â”‚  â”‚  POST /api/auth/register â”€â”€â”€â”€â”€â”€â”€â–º                     â”‚    â”‚
â”‚  â”‚  POST /api/auth/logout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚         Browser Cookies (Automatic)                   â”‚     â”‚
â”‚  â”‚                                                        â”‚     â”‚
â”‚  â”‚  auth_token=<JWT_TOKEN>                              â”‚     â”‚
â”‚  â”‚    HttpOnly, Secure, SameSite=Strict, Max-Age=86400 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ HTTPS Requests
                                               â”‚ (with Cookies)
                                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND (Server)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚               Vercel Serverless Functions                â”‚   â”‚
â”‚  â”‚                       (Node.js)                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€ POST /api/auth/login â”€â”€â”€â”€â”                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Validate email          â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Hash password check     â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Generate JWT token      â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Set auth_token cookie   â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Return redirect URL     â”‚                         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€ POST /api/auth/register â”€â”€â”                        â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Validate input           â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Hash password (bcryptjs) â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Insert user in DB        â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Generate JWT token       â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Set auth_token cookie    â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Return redirectUrl       â”‚                         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€ GET /api/auth/verify â”€â”€â”€â”€â”€â”                        â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Extract token from cookieâ”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Verify JWT signature     â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Return user data         â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Return 401 if invalid    â”‚                         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€ POST /api/auth/logout â”€â”€â”€â”€â”                        â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Clear auth_token cookie â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Return 200 success      â”‚                         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€ GET /api/user/profile â”€â”€â”€â”€â”                        â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Check auth (401 if not) â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Query user from DB      â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Return user data        â”‚                         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            Shared Libraries (Node.js)                     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  lib/auth.js          - JWT generation/verification     â”‚   â”‚
â”‚  â”‚  lib/password.js      - Password hashing (bcryptjs)    â”‚   â”‚
â”‚  â”‚  lib/validation.js    - Input validation               â”‚   â”‚
â”‚  â”‚  lib/db.js            - PostgreSQL connection          â”‚   â”‚
â”‚  â”‚  lib/rateLimit.js     - Rate limiting                  â”‚   â”‚
â”‚  â”‚  lib/errors.js        - Error handling                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚ SQL Queries
                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  PostgreSQL (Vercel Postgres / Supabase)                        â”‚
â”‚                                                                    â”‚
â”‚  Table: public.users                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ id                   INTEGER PRIMARY KEYâ”‚                    â”‚
â”‚  â”‚ email                VARCHAR UNIQUE     â”‚                    â”‚
â”‚  â”‚ name                 VARCHAR            â”‚                    â”‚
â”‚  â”‚ password_hash        VARCHAR            â”‚ (bcryptjs)         â”‚
â”‚  â”‚ gender               VARCHAR            â”‚ (optional)         â”‚
â”‚  â”‚ birth_date           DATE               â”‚ (optional)         â”‚
â”‚  â”‚ birth_time           TIME               â”‚ (optional)         â”‚
â”‚  â”‚ birth_place          VARCHAR            â”‚ (optional)         â”‚
â”‚  â”‚ relationship_status  VARCHAR            â”‚ (optional)         â”‚
â”‚  â”‚ focus_area          VARCHAR            â”‚ (optional)         â”‚
â”‚  â”‚ last_login_at        TIMESTAMP          â”‚                    â”‚
â”‚  â”‚ created_at           TIMESTAMP          â”‚                    â”‚
â”‚  â”‚ updated_at           TIMESTAMP          â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagrams

### Login Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Enters credentials
     â”‚ (email, password)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ login.html       â”‚
â”‚ (form)           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ fetch('/api/auth/login', { POST, JSON })
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: /api/auth/login           â”‚
â”‚                                     â”‚
â”‚ 1. Validate email format           â”‚
â”‚ 2. Rate limit check (5 per 15m)   â”‚
â”‚ 3. Query DB for user by email     â”‚
â”‚ 4. Compare passwords (bcryptjs)   â”‚
â”‚ 5. Generate JWT token              â”‚
â”‚ 6. Set auth_token cookie           â”‚
â”‚ 7. Update last_login_at           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Response 200:
     â”‚ {
     â”‚   success: true,
     â”‚   user: { id, email, name },
     â”‚   redirectUrl: '../dashboard.html'
     â”‚ }
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ auth.js                          â”‚
â”‚                                   â”‚
â”‚ result.redirectUrl               â”‚
â”‚ â†’ window.location.href = result â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Navigate to /dashboard.html
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ dashboard.html loads                â”‚
â”‚                                       â”‚
â”‚ 1. auth-state.js IIFE               â”‚
â”‚ 2. AuthState.initialize()           â”‚
â”‚ 3. Calls /api/auth/verify           â”‚
â”‚ 4. Sets AuthState.isAuthenticated   â”‚
â”‚ 5. header-loader.js injects header  â”‚
â”‚ 6. updateHeaderAuthState()          â”‚
â”‚ 7. Header renders greeting          â”‚
â”‚ 8. dashboard.js loads profile       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User sees:                       â”‚
â”‚ âœ… Authenticated header          â”‚
â”‚ âœ… "Hello [Name]"               â”‚
â”‚ âœ… Dashboard with profile       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Logout Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User       â”‚
â”‚ clicks     â”‚
â”‚ "Ğ’Ñ‹Ğ¹Ñ‚Ğ¸"    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleHeaderLogout  â”‚
â”‚ (event handler)    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ AuthState.logout()
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: POST /api/auth/logout    â”‚
â”‚                                    â”‚
â”‚ 1. Set-Cookie: auth_token=        â”‚
â”‚    - HttpOnly                      â”‚
â”‚    - SameSite=Strict              â”‚
â”‚    - Max-Age=0 (expires now)      â”‚
â”‚ 2. Response 200: { success: true }â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AuthState                 â”‚
â”‚ clearAuthentication()     â”‚
â”‚ notifySubscribers()       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ header-loader.js receives       â”‚
â”‚ AuthState subscription update   â”‚
â”‚ updateHeaderAuthState()         â”‚
â”‚ renderLoggedOutHeader()         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header renders immediately       â”‚
â”‚ without page reload              â”‚
â”‚ Shows: "Ğ’Ğ¾Ğ¹Ñ‚Ğ¸" + "Get Forecast"  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ window.location.href = indexHref
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User sees:                       â”‚
â”‚ âœ… Logout header                 â”‚
â”‚ âœ… Redirected to homepage        â”‚
â”‚ âœ… Cookie cleared                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Navigation Flow (Session Persistence)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User logged in on dashboard     â”‚
â”‚ Click logo â†’ navigate to /      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ index.html loads                       â”‚
â”‚                                         â”‚
â”‚ <script src="js/auth-state.js"></script>â”‚
â”‚ <script src="js/header-loader.js"></script>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ auth-state.js IIFE fires       â”‚
â”‚ (DOMContentLoaded or immediate)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AuthState.initialize()                         â”‚
â”‚                                                 â”‚
â”‚ fetch('/api/auth/verify', {                   â”‚
â”‚   method: 'GET',                              â”‚
â”‚   credentials: 'include'  â† Sends cookies     â”‚
â”‚ })                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: GET /api/auth/verify                 â”‚
â”‚                                                 â”‚
â”‚ 1. Extract auth_token from cookies             â”‚
â”‚ 2. Verify JWT signature                        â”‚
â”‚ 3. Return user data and authenticated: true    â”‚
â”‚    (if valid)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AuthState.setAuthenticated(user)         â”‚
â”‚ - isAuthenticated = true                 â”‚
â”‚ - user = { id, email, name }            â”‚
â”‚ - notifySubscribers()                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ header-loader.js                               â”‚
â”‚ (subscribed to AuthState)                      â”‚
â”‚                                                 â”‚
â”‚ updateHeaderAuthState()                        â”‚
â”‚ â†’ AuthState.isLoggedIn() = true               â”‚
â”‚ â†’ renderLoggedInHeader()                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header renders with:                     â”‚
â”‚ âœ… "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, [Name]"                     â”‚
â”‚ âœ… "Ğ›Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ°Ğ±Ğ¸Ğ½ĞµÑ‚" button               â”‚
â”‚ âœ… "Ğ’Ñ‹Ğ¹Ñ‚Ğ¸" button                        â”‚
â”‚                                           â”‚
â”‚ NO page reload needed!                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Technology Stack

### Frontend
- **Language:** JavaScript (ES5 compatible)
- **Architecture:** Vanilla JS, no frameworks
- **Module System:** Global objects (window.AuthState)
- **HTTP Client:** Fetch API
- **Storage:** Browser cookies (automatic)
- **State Management:** AuthState (in-memory + observers)

### Backend
- **Runtime:** Node.js (>=18.x)
- **Framework:** Vercel Serverless Functions (Express-like)
- **Language:** JavaScript
- **Authentication:** JWT (jsonwebtoken library)
- **Password Hashing:** bcryptjs
- **Input Validation:** validator library
- **Database:** PostgreSQL
- **Rate Limiting:** In-memory (per process)

### Infrastructure
- **Hosting:** Vercel (serverless)
- **Database:** Vercel Postgres / Supabase
- **CORS:** Configured in vercel.json
- **SSL:** Automatic (Vercel)
- **Environment:** Variables in .env files

---

## File Structure

```
Ezoterra/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ login.js              â† Login endpoint
â”‚   â”‚   â”œâ”€â”€ register.js           â† Registration endpoint
â”‚   â”‚   â”œâ”€â”€ logout.js             â† Logout endpoint
â”‚   â”‚   â””â”€â”€ verify.js             â† Auth verification endpoint
â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â””â”€â”€ profile.js            â† Protected user profile
â”‚   â””â”€â”€ dev-server.js
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ auth.js                   â† JWT utils
â”‚   â”œâ”€â”€ password.js               â† Password hashing
â”‚   â”œâ”€â”€ validation.js             â† Input validation
â”‚   â”œâ”€â”€ db.js                     â† Database connection
â”‚   â””â”€â”€ rateLimit.js              â† Rate limiting
â”œâ”€â”€ ezotera-frontend/
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ auth-state.js         â† NEW: Auth state management
â”‚   â”‚   â”œâ”€â”€ header-loader.js      â† MODIFIED: Dynamic header
â”‚   â”‚   â”œâ”€â”€ navigation.js         â† Mobile menu logic
â”‚   â”‚   â””â”€â”€ dashboard.js          â† Dashboard logic
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ login.html
â”‚   â”‚   â”œâ”€â”€ register.html
â”‚   â”‚   â””â”€â”€ auth.js               â† Form handling
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ header.html           â† MODIFIED: Added IDs
â”‚   â”œâ”€â”€ index.html                â† MODIFIED: Added auth-state.js
â”‚   â”œâ”€â”€ dashboard.html            â† MODIFIED: Added auth-state.js
â”‚   â””â”€â”€ css/
â”‚       â”œâ”€â”€ global.css
â”‚       â”œâ”€â”€ header.css
â”‚       â””â”€â”€ ...
â”œâ”€â”€ .env.production               â† JWT_SECRET, POSTGRES_URL
â”œâ”€â”€ vercel.json                   â† CORS, security headers
â””â”€â”€ package.json
```

---

## Security Architecture

### Cookie Security
```
Browser Cookie:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ auth_token=eyJhbGc...                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HttpOnly    âœ… Not accessible to JS       â”‚
â”‚ Secure      âœ… Only sent over HTTPS      â”‚
â”‚ SameSite    âœ… Not sent cross-domain     â”‚
â”‚ Max-Age     âœ… Expires in 24h            â”‚
â”‚ Path        âœ… Only sent to /            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Token Security
```
JWT Token:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header:   { alg: 'HS256', typ: 'JWT' }â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Payload:  { userId, email }           â”‚
â”‚           (Expiration: 24h)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Signature: HMAC-SHA256(                â”‚
â”‚   header.payload,                      â”‚
â”‚   JWT_SECRET                           â”‚
â”‚ )                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Verified on each request:
âœ… Signature validates (server secret required)
âœ… Token not expired
âœ… Claims present
```

### Password Security
```
User Password:
"MyPassword123" (user input)
         â”‚
         â”‚ bcryptjs.hash()
         â”‚ + salt rounds: 10
         â”‚ + random salt: $2b$10$...
         â–¼
"$2b$10$N9qo8uLOickgx2ZMRZoMye..."
         â”‚
         â”‚ Stored in database
         â”‚ (never plain text)
         â”‚
         â–¼
On Login:
bcryptjs.compare(input, hash) â†’ boolean
```

---

## API Contracts

### GET /api/auth/verify

**Request:**
```http
GET /api/auth/verify
Cookie: auth_token=<JWT>
```

**Response (Authenticated):**
```json
{
  "success": true,
  "authenticated": true,
  "user": {
    "id": 123,
    "email": "user@example.com"
  }
}
```

**Response (Not Authenticated):**
```json
{
  "success": false,
  "authenticated": false,
  "message": "ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ° Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ"
}
```

---

### POST /api/auth/login

**Request:**
```json
{
  "email": "user@example.com",
  "password": "SecurePass123",
  "remember": false
}
```

**Response (Success):**
```json
{
  "success": true,
  "message": "Ğ’Ñ…Ğ¾Ğ´ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾",
  "user": {
    "id": 123,
    "email": "user@example.com",
    "name": "John Doe"
  },
  "redirectUrl": "../dashboard.html"
}
```

**Response (Error):**
```json
{
  "success": false,
  "message": "ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ email Ğ¸Ğ»Ğ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ"
}
```

---

### POST /api/auth/logout

**Request:**
```http
POST /api/auth/logout
Cookie: auth_token=<JWT>
```

**Response:**
```json
{
  "success": true,
  "message": "Ğ’Ñ‹Ñ…Ğ¾Ğ´ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾"
}
```

**Cookie cleared:**
```http
Set-Cookie: auth_token=; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=0
```

---

## Performance Considerations

### Critical Path
1. auth-state.js loads (1-10ms)
2. AuthState.initialize() called (0ms)
3. /api/auth/verify request sent (5-20ms network latency)
4. Response received (0ms)
5. AuthState sets state (0ms)
6. header-loader.js continues (2-5ms)
7. Header renders (10-20ms)

**Total:** ~30-60ms until header visible

### Optimizations Already In Place
- âœ… AuthState uses memory cache (no repeated API calls)
- âœ… Header template cached in sessionStorage
- âœ… Parallel loading (scripts don't block each other)
- âœ… Minimal DOM operations (no excessive reflows)
- âœ… Event delegation (single listener, not per button)

### Potential Future Optimizations
- [ ] Service Worker for offline support
- [ ] IndexedDB for persistent cache
- [ ] Compression for token size
- [ ] Edge caching (Vercel Incremental Static Regeneration)
- [ ] CDN for static assets

---

**Architecture is production-ready and optimized for performance, security, and maintainability.** âœ…
